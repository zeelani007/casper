"use strict";var __decorate=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,i=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;0<=n;n--)(o=e[n])&&(i=(a<3?o(i):3<a?o(t,r,i):o(t,r))||i);return 3<a&&i&&Object.defineProperty(t,r,i),i},__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var s=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,n=a.length;i<n;i++,o++)s[o]=a[i];return s};exports.__esModule=!0;var core_1=require("@angular/core"),forms_1=require("@angular/forms");require("rxjs/add/operator/debounceTime"),require("rxjs/add/observable/fromEvent"),require("rxjs/add/observable/merge");var Observable_1=require("rxjs/Observable"),number_validator_1=require("../shared/number.validator"),generic_validator_1=require("../shared/generic-validator"),layout_1=require("@angular/cdk/layout"),CustomerFormComponent=function(){function e(e,t,r,s,o){var a=this;this.fb=e,this.route=t,this.router=r,this.customerService=s,this.breakpointObserver=o,this.pageTitle="Update Customer",this.customer={},this.imageWidth=100,this.imageMargin=2,this.fieldColspan=3,this.displayMessage={},this.validationMessages={firstname:{required:"Customer first name is required.",minlength:"Customer first name must be at least one characters.",maxlength:"Customer first name cannot exceed 100 characters."},lastname:{required:"Customer last name is required.",minlength:"Customer last name must be at least one characters.",maxlength:"Customer last name cannot exceed 100 characters."},email:{required:"Customer email is required.",minlength:"Customer email must be at least one characters.",maxlength:"Customer email cannot exceed 200 characters."},rewards:{range:"Rewards of the customer must be between 0 (lowest) and 150 (highest)."},phone:{maxlength:"Customer phone cannot exceed 12 characters."},mobile:{maxlength:"Customer mobile cannot exceed 12 characters."}},o.observe([layout_1.Breakpoints.HandsetLandscape,layout_1.Breakpoints.HandsetPortrait]).subscribe(function(e){a.onScreensizeChange(e)}),this.genericValidator=new generic_validator_1.GenericValidator(this.validationMessages)}return e.prototype.ngOnInit=function(){var r=this;this.customerForm=this.fb.group({firstname:["",[forms_1.Validators.required,forms_1.Validators.minLength(3),forms_1.Validators.maxLength(100)]],lastname:["",[forms_1.Validators.required,forms_1.Validators.minLength(3),forms_1.Validators.maxLength(100)]],email:["",[forms_1.Validators.required,forms_1.Validators.minLength(5),forms_1.Validators.maxLength(200)]],rewards:["",number_validator_1.NumberValidators.range(0,150)],phone:["",forms_1.Validators.maxLength(12)],mobile:["",forms_1.Validators.maxLength(12)],membership:!1}),this.sub=this.route.params.subscribe(function(e){var t=+e.id;r.getCustomer(t)}),this.sub.add(null)},e.prototype.ngOnDestroy=function(){this.sub.unsubscribe()},e.prototype.ngAfterViewInit=function(){var t=this,e=this.formInputElements.map(function(e){return Observable_1.Observable.fromEvent(e.nativeElement,"blur")});Observable_1.Observable.merge.apply(Observable_1.Observable,__spreadArrays([this.customerForm.valueChanges],e)).debounceTime(500).subscribe(function(e){t.displayMessage=t.genericValidator.processMessages(t.customerForm)})},e.prototype.getCustomer=function(e){var t=this;this.customerService.getCustomer(e).subscribe(function(e){return t.onCustomerRetrieved(e)},function(e){return t.errorMessage=e})},e.prototype.onCustomerRetrieved=function(e){this.customerForm&&this.customerForm.reset(),this.customer=e,0===this.customer.id?this.pageTitle="New Customer":this.pageTitle="Customer: "+this.customer.firstname+" "+this.customer.lastname,this.customerForm.patchValue({firstname:this.customer.firstname,lastname:this.customer.lastname,email:this.customer.email,rewards:this.customer.rewards,phone:this.customer.phone,mobile:this.customer.mobile,membership:this.customer.membership})},e.prototype.deleteCustomer=function(){var t=this;0===this.customer.id?this.onSaveComplete():confirm("Really delete the customer: "+this.customer.firstname+"?")&&this.customerService.deleteCustomer(this.customer.id).subscribe(function(){return t.onSaveComplete()},function(e){return t.errorMessage=e})},e.prototype.toggleImage=function(){event.preventDefault(),this.showImage=!this.showImage},e.prototype.saveCustomer=function(){var t=this;if(this.customerForm.dirty&&this.customerForm.valid){var e=Object.assign({},this.customer,this.customerForm.value);this.customerService.saveCustomer(e).subscribe(function(){return t.onSaveComplete()},function(e){return t.errorMessage=e})}else this.customerForm.dirty||this.onSaveComplete()},e.prototype.onSaveComplete=function(){this.customerForm.reset(),this.router.navigate(["/customers"])},e.prototype.onScreensizeChange=function(e){var t=this.breakpointObserver.isMatched("(max-width: 599px)"),r=this.breakpointObserver.isMatched("(max-width: 959px)");console.log(" isLess600  "+t+" \n            isLess1000 "+r+"  "),this.fieldColspan=r?t?12:6:3},__decorate([core_1.ViewChildren(forms_1.FormControlName,{read:core_1.ElementRef})],e.prototype,"formInputElements"),e=__decorate([core_1.Component({selector:"customer-form",templateUrl:"./customer-form.component.html",styles:["\n    .title-spacer {\n        flex: 1 1 auto;\n      }\n    .form-field{\n        width: 100%;\n        margin-left: 20px;\n        margin-right: 20px;\n    }\n    .avatar-field {\n        left: 0;\n        margin: 0 auto;\n        position: absolute;\n        margin-left: 50px;\n    }\n    "]})],e)}();exports.CustomerFormComponent=CustomerFormComponent;
//# sourceMappingURL=customer-form.component.min.js.map
